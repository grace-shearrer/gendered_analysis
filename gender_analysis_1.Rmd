---
title: "Gendered perspective paper - SSB analysis"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---
This is an analysis based on the paper "The association of food parenting practices with adolescentsâ€™ dietary
behaviors differ by youth gender, but not by parent gender" by Deslippe et al., 2022

```{r message=FALSE, warning=FALSE, results='hide'}
library(vroom)
library(plyr)
library(ggplot2)
library(psych)
library(tidyverse)
library(OpenMx)
library(dplyr)
library(lavaan)
library(semPlot)
library(knitr)
library(kableExtra)
library(GGally)
```

```{r message=FALSE, warning=FALSE, results='hide'}
df<-vroom("~/University of Wyoming/M2AENAD Lab - Documents/RESEARCH/multi-state/data/final_df.csv")
df$parent_gender<-as.factor(df$parent_gender)
df$child_SEX<-as.factor(df$child_SEX)
```
# SSB Models
## Basic model
```{r}
m1 <-'SSB_sqrt_scale ~ IND_scale + EXP_scale + AVA_log10_scale + MON_scale + AUT_sqrt_scale + MOD_log10_scale + parent_gender + parent_ED + INCOME + RACE_ETH + child_SEX'
```

## Confirmatory factor analysis 
```{r}
fit1 <- cfa(m1, data = df)
```

## Summary of SSB CFA
```{r}
summary(fit1, standardized=T,rsquare=T)
```
## Visualization of SSB CFA
```{r}
semPaths(fit1, 'std', layout = 'spring')
```
# Summary of CFA
Indulgence, monitoring related to SSB

## Interaction models
```{r}
med_IND_ <- "# mediator, a path
         parent_gender ~ a*IND_scale

         # b path
         SSB_sqrt_scale ~ b*parent_gender

         # direct effect 
         SSB_sqrt_scale ~ cp * IND_scale

         # indirect 
         ab := a*b
         
         # Total effects
         total := cp + (a*b)
"

med_MON_ <- "# a path
         parent_gender ~ a * MON_scale 

         # b path
         SSB_sqrt_scale ~ b * parent_gender

         # c prime path 
         SSB_sqrt_scale ~ cp * MON_scale 

         # indirect and total effects
         ab := a * b
         total := cp + (a*b)
"
```

```{r}
set.seed(1234)
```

### Running the models
```{r}
df$parent_gender<-as.ordered(df$parent_gender)
IND_sem <- sem(med_IND_, data = df, se = "bootstrap", bootstrap = 5000, estimator = "DWLS")
MON_sem <- sem(med_MON_, data = df, se = "bootstrap", bootstrap = 5000, estimator = "DWLS")
```

### Parameter estimates for indulgence
```{r}
parameterestimates(IND_sem, boot.ci.type = "bca.simple", standardized = TRUE) 
```

### Parameter estimates for monitoring
```{r}
parameterestimates(MON_sem, boot.ci.type = "bca.simple", standardized = TRUE) 
```

# Summary of results
* No mediation for indulgence based on parent gender
* Parent gender appear to trend toward mediating the relationship between ssb intake and parental monitoring (est = 0.017, CI= -0.001:0.042)
Will only carry forward monitoring

# Is mediation (parental gender) moderated by child sex (female < male) ?

## Model with grouping
```{r}
MON_group <- ' 
             # mediator, a path
             parent_gender ~ c(ag1,ag2)*MON_scale
             SSB_sqrt_scale ~ c(bg1,bg2)*parent_gender 
           
             # direct effect
             SSB_sqrt_scale ~  c(cg1, cg2)*MON_scale

           # indirect effect (a*b)
             abg1 := ag1*bg1 #group 1
             abg2 := ag2*bg2 #group 2

           # total effect
             totalg1 := cg1 + (ag1*bg1)
             totalg2 := cg2 + (ag2*bg2)
         '
```


## Running group models
```{r}
fit_group_MON <- sem(MON_group, data = df, group="child_SEX", 
                 se="boot", bootstrap=5000, meanstructure = TRUE, estimator = "DWLS")
```

```{r}
summary(fit_group_MON, fit.measures=T, standardized=T, ci=TRUE)
```

```{r}
all.constraints<- 'ag1 == ag2
                  bg1 == bg2
                  cg1 == cg2'
```


```{r}
lavTestWald(fit_group_MON, #the name of the Lavaan 'fitted' object
            constraints = all.constraints) #the name of our previously specified paths that we would like to test
```
# Summary of moderation results
Child sex does not moderate the relationship between monitoring by parental gender and SSB intake 

```{r}
#save.image(file = "~/University of Wyoming/M2AENAD Lab - Documents/RESEARCH/multi-state/data/SSBanalysis.RData")
```

