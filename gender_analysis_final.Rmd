---
title: "gender_analysis_final"
output: html_document
date: '2023-12-07'
---

This is an analysis based on the paper "The association of food parenting practices with adolescentsâ€™ dietary
behaviors differ by youth gender, but not by parent gender" by Deslippe et al., 2022

Redoing this with Yichen's dataset

```{r message=FALSE, warning=FALSE, results='hide'}
library(vroom)
library(plyr)
library(ggplot2)
library(psych)
library(tidyverse)
library(OpenMx)
library(dplyr)
library(lavaan)
library(semPlot)
library(knitr)
library(kableExtra)
library(GGally)
library(lavaanPlot)
library(lm.beta)
library(modelsummary)

#library(boot)
library(semTools)
source("~/Downloads/x.boot.r")  
library(emmeans)
library(rempsyc)
library(gridExtra)

```
# Why
The previous notebook I tried to normalize the data. When I normalized the data the log function actually made everything worse. I am trying to fit the non-normal data this time. 

```{r message=FALSE, warning=FALSE, results='hide'}
df<-vroom("/Users/gracer/Library/CloudStorage/OneDrive-UniversityofWyoming/0. Lab/M2AENAD Lab - Documents/RESEARCH/multi-state/gender_paper/2. data/iEOparent_food.csv")
#names(df)
```

## Mean center
```{r}
scaled_data <- 
  df %>%
  mutate(SSB_freq = scale(SSB, scale = FALSE),
         JUNK_freq = scale(Junk.foods, scale = FALSE),
         SWEET_freq = scale(Sugary.foods, scale = FALSE),
         FV_freq = scale(Fruits.vegetables, scale = FALSE),
         INDULGENCE = scale(Indulgence, scale = FALSE),
         EXPECATION = scale(Expectations, scale = FALSE),
         AVAILABILE = scale(Availability, scale = FALSE),
         MONITORING = scale(Monitoring, scale = FALSE),
         AUTONOMY = scale(Autonomy.Support, scale = FALSE),
         MODELING = scale(Modeling, scale = FALSE)
         )
```

child sex = sex, Q6.3
parent sex = Q6.11
ethnicity = Q6.18
```{r}
summary(as.factor(df$Q6_18))
names(df)
```
# Renaming factors for the tables
```{r}
df_factors<- df %>% 
  mutate(
    Marital_status = fct_recode(as.factor(Marital.status),
                      "Not married" = "1",
                      "Married" = "2"),
    Parent_gender = fct_recode(as.factor(Q6_11),
                      "Male" = "1",
                      "Female" = "2"),
    Ethnicity = fct_recode(as.factor(Q6_18),
                      "Male" = "1",
                      "Female" = "2"),
        Income = fct_recode(as.factor(Q6_17),
                      "Below $25,000" = "1",
                      "$65,000 - $84,999" = "4",
                      "$45,000 - $64,999" = "3",
                      "$85,000 or more" = "5",
                      "$25,000 - $44,999" = "2",
                      "Prefer not to answer" = "6"
                      ),
    child_sex = fct_recode(as.factor(Q6_3),
                      "Male" = "1",
                      "Female" = "2"
                      ),
    education = fct_recode(as.factor(Q6_14),
                      "4-year college, university degree or advanced degree" = "4",
                      "Some college or technical school" = "3",
                      "Received high school diploma or GED" = "2",
                      "Have not completed high school" = "1"
                      
                      ),
    ethnicity = fct_recode(as.factor(Q6_18),
                      "Hispanic or Latinx" = "1",
                      "Not Hispanic or Latinx" = "2"
                      
                      )
  )
```


# Making descriptive table
## Table 1. Sample demographics by parent sex
### Factors
```{r}
#(`Flipper length (mm)` = flipper_length_mm)

datasummary((`Marital status` = Marital_status) + Race+ (`Ethnicity` = ethnicity)+ Income + (`Child sex` = child_sex) + (`Food security` = Food.security) + (`Education` = education) ~ (`Parent gender` = Parent_gender) * Percent("col")+1*Percent("col"),
            data = df_factors,
            output = '/Users/gracer/Library/CloudStorage/OneDrive-UniversityofWyoming/0. Lab/M2AENAD Lab - Documents/RESEARCH/multi-state/gender_paper/table1.docx')
```

### Continuous
```{r}
MeanSD <- function(x) paste0(round(mean(x, na.rm = TRUE),2),'(', round(sd(x, na.rm = TRUE),2), ')')

```

```{r}
datasummary((`Autonomy support` = Autonomy.Support) + Monitoring + Availability + Indulgence + Modeling + Expectations + (`SSB consumption frequency` = SSB) + (`Junk food consumption frequency` = Junk.foods) + (`Fruit and Vegetable consumption frequency` = Fruits.vegetables) + (`Sugary food consumption frequency` = Sugary.foods) + (`Independent eating occassion frequency` = iEO) ~ Parent_gender* (MeanSD) + 1*(MeanSD),
            data = df_factors,
            output = '/Users/gracer/Library/CloudStorage/OneDrive-UniversityofWyoming/0. Lab/M2AENAD Lab - Documents/RESEARCH/multi-state/gender_paper/table1_b.docx')
```

### Check differences
```{r}
summary(df_factors$Parent_gender)
t.test(df_factors$iEO ~ df_factors$Parent_gender)
```
```{r}
mytable <- xtabs(~Parent_gender+Marital.status, data=df_factors)
summary(mytable) # chi-square test of indepedence
```

# Checking regressions against main paper for sanity
```{r}
check_FV_auto<-lm(Fruits.vegetables ~ Autonomy.Support +  Age + Race + Sex + Education + Food.security + Marital.status + iEO, data = df )
summary(check_FV_auto) # b values match the parent reporting parenting practice
```

## Basic model
food security, parent education, child sex, race/ethnicity, independent eating occasions (from covar analysis)
```{r}
mFV <-'FV_freq ~ INDULGENCE + EXPECATION + AVAILABILE + MONITORING + AUTONOMY + MODELING + Q6_11  + Race + Sex + Education + Food.security + iEO'
mSSB <-'SSB_freq ~ INDULGENCE + EXPECATION + AVAILABILE + MONITORING + AUTONOMY + MODELING + Q6_11  + Race + Sex + Education + Food.security + iEO'
mJUNK <-'JUNK_freq ~ INDULGENCE + EXPECATION + AVAILABILE + MONITORING + AUTONOMY + MODELING + Q6_11  + Race + Sex + Education + Food.security + iEO'
mSWEET <-'SWEET_freq ~ INDULGENCE + EXPECATION + AVAILABILE + MONITORING + AUTONOMY + MODELING + Q6_11  + Race + Sex + Education + Food.security + iEO'
```

## Refactor levels of race
```{r}
scaled_data$Race <- factor(scaled_data$Race, levels = c("Non-Hispanic White","Non-Hispanic Black", "Asian", "Hispanic", "Other races"))
```


## Summary
Basic models were not significant thus bootstrapping was not required
```{r}
models <- list(
  "Fruits and Vegetables"     = lm(mFV, data = scaled_data),
  "SSB"     = lm(mSSB, data = scaled_data),
  "Junk Foods"     = lm(mJUNK, data = scaled_data),
  "Sugary foods"     = lm(mSWEET, data = scaled_data)
)

modelsummary(
  models,
  fmt = 1,
  estimate  = "{estimate} [{conf.low}, {conf.high}] {stars}",
  statistic = NULL,
  coef_omit = "Intercept",
  coef_rename = c("Q6_11" = "parent sex", "RaceHispanic" = "Hispanic", "RaceNon-Hispanic Black" = "Non-Hispanic Black","RaceNon-Hispanic White" = "Non-Hispanic White", "SexGirl" = "Child girl", "RaceAsian" = "Asian", "RaceOther races" = "Other races"), output = "/Users/gracer/Library/CloudStorage/OneDrive-UniversityofWyoming/0. Lab/M2AENAD Lab - Documents/RESEARCH/multi-state/gender_paper/linearmodels_table.docx")
```
# Summary of CFA
INDULGENCE
MONITORING
iEO
```{r}
parent <- "INDULGENCE"
food <- "FV_freq"
my_string <- sprintf("this is my %s string", new)
```


```{r}
modelr <- function(parent,food){
  sprintf("
         # mediator, a path
         Q6_11 ~ a*%s+iEO

         # b path
        %s ~ b*Q6_11

         # direct effect 
         %s ~ cp * %s+iEO

         # indirect 
         ab := a*b
         
         # Total effects
         total := cp + (a*b)
        ",parent,food, food, parent)
}
```

```{r}
check <-sem(modelr("INDULGENCE","SSB_freq"), data = scaled_data, estimator = "MLM")
summary(check)
```

```{r}
food_list <- list("FV_freq","SSB_freq","JUNK_freq","SWEET_freq")

```

```{r}
sublist <- list()
for (y in food_list){
    model<-modelr("INDULGENCE",y)
    output <- sem(model, data = scaled_data, estimator = "MLM")
    sublist[[y]] <- list(output)
}
```


```{r}
modelsummary(
  c(sublist$FV_freq,
    sublist$SSB_freq,
    sublist$JUNK_freq, 
    sublist$SWEET_freq),
  fmt = 1,
  estimate  = "{estimate} [{conf.low}, {conf.high}],{stars}",
  statistic = NULL,
  )

```
 
```{r}
sublist2 <- list()
for (y in food_list){
    model<-modelr("MONITORING",y)
    output <- sem(model, data = scaled_data, estimator = "MLM")
    sublist2[[y]] <- list(output)
}
```


```{r}
cm <- c('Q6_11 ~ MONITORING'    = 'Monitoring by parent gender',
        'FV_freq ~ Q6_11' = 'Fruit and vegetable intake by parent gender',
        'FV_freq ~ MONITORING' = 'Fruit and vegetable intake by monitoring',
        'SSB_freq ~ Q6_11' = 'SSB intake by parent gender',
        'SSB_freq ~ MONITORING' = 'SSB intake by monitoring',
        'JUNK_freq ~ Q6_11' = 'Junk food intake by parent gender',
        'JUNK_freq ~ MONITORING	' = 'Junk food intake by monitoring',
        'SWEET_freq ~ Q6_11' = 'Sugary food intake by parent gender',
        'SWEET_freq ~ MONITORING' = 'Sugary food intake by monitoring'
        )

modelsummary(
  c(sublist2$FV_freq,
    sublist2$SSB_freq,
    sublist2$JUNK_freq, 
    sublist2$SWEET_freq),
  fmt = 1,
  estimate  = "{estimate} [{conf.low}, {conf.high}],{stars}",
  statistic = NULL,
  )
```


8/31/23

Random selection
```{r}
summary(as.factor(m_data$Q6_11))
f_data <-subset(scaled_data, scaled_data$Q6_11 == 2)
f_sub_data<-f_data[sample(nrow(f_data), 211), ]
m_data <-subset(scaled_data, scaled_data$Q6_11 == 1)

sub_data <- rbind(m_data, f_sub_data)
summary(as.factor(sub_data$Q6_11))
```

```{r}
sub_sublist <- list()
n = 100000
my_range <- 1:n
for (x in my_range){
    #separate females and randomly sample
    f_data <-subset(scaled_data, scaled_data$Q6_11 == 2)
    f_sub_data<-f_data[sample(nrow(f_data), 211), ]
    #separate males
    m_data <-subset(scaled_data, scaled_data$Q6_11 == 1)
    #recombine the male and subset female data
    sub_data <- rbind(m_data, f_sub_data)
    sub_data$Race <- factor(sub_data$Race, levels = c("Non-Hispanic White","Non-Hispanic Black", "Asian", "Hispanic", "Other races"))
    sub_model<-modelr("INDULGENCE","SSB")
    sub_output <- summary(sem(sub_model, data = sub_data, estimator = "MLM"))
    sub_sublist[[x]] <- list(sub_output$PE[11,])

}

null<-rep(0.05, each=n)
SSB_med_df<-bind_rows(sub_sublist, .id = "column_label")
t.test(SSB_med_df$pvalue, null)
SSB_med_df
```


## Refactor levels of race
```{r}
sub_data$Race <- factor(sub_data$Race, levels = c("Non-Hispanic White","Non-Hispanic Black", "Asian", "Hispanic", "Other races"))
```


## Summary
No difference to full sample
```{r}
sub_models <- list(
  "Fruits and Vegetables"     = lm(mFV, data = sub_data),
  "SSB"     = lm(mSSB, data = sub_data),
  "Junk Foods"     = lm(mJUNK, data = sub_data),
  "Sugary foods"     = lm(mSWEET, data = sub_data)
)

modelsummary(
  sub_models,
  fmt = 1,
  estimate  = "{estimate} [{conf.low}, {conf.high}] {stars}",
  statistic = NULL,
  coef_omit = "Intercept",
  coef_rename = c("Q6_11" = "parent sex", "RaceHispanic" = "Hispanic", "RaceNon-Hispanic Black" = "Non-Hispanic Black","RaceNon-Hispanic White" = "Non-Hispanic White", "SexGirl" = "Child girl", "RaceAsian" = "Asian", "RaceOther races" = "Other races"), output = "/Users/gracer/Library/CloudStorage/OneDrive-UniversityofWyoming/0. Lab/M2AENAD Lab - Documents/RESEARCH/multi-state/gender_paper/test_linearmodels_table.docx")
```


```{r}
food_list <- list("FV_freq","SSB_freq","JUNK_freq","SWEET_freq")

```

```{r}
sub_sublist <- list()
for (y in food_list){
    sub_model<-modelr("INDULGENCE",y)
    sub_output <- sem(sub_model, data = sub_data, estimator = "MLM")
    sub_sublist[[y]] <- list(sub_output)
}
```

```{r}
sub_model<-modelr("MONITORING","SSB_freq")
test_sum<-summary(sem(sub_model, data = sub_data, estimator = "MLM"))
test_sum$PE[,1]
test_sum$PE[11,]

```

```{r}
test_sum <-modelsummary(
  c(sub_sublist$FV_freq),
  fmt = 1,
  estimate  = "{estimate} [{conf.low}, {conf.high}],{stars}",
  statistic = NULL,
  )
test_sum[1]
```
 
```{r}
sublist2 <- list()
for (y in food_list){
    model<-modelr("MONITORING",y)
    output <- sem(model, data = scaled_data, estimator = "MLM")
    sublist2[[y]] <- list(output)
}
```


```{r}
cm <- c('Q6_11 ~ MONITORING'    = 'Monitoring by parent gender',
        'FV_freq ~ Q6_11' = 'Fruit and vegetable intake by parent gender',
        'FV_freq ~ MONITORING' = 'Fruit and vegetable intake by monitoring',
        'SSB_freq ~ Q6_11' = 'SSB intake by parent gender',
        'SSB_freq ~ MONITORING' = 'SSB intake by monitoring',
        'JUNK_freq ~ Q6_11' = 'Junk food intake by parent gender',
        'JUNK_freq ~ MONITORING	' = 'Junk food intake by monitoring',
        'SWEET_freq ~ Q6_11' = 'Sugary food intake by parent gender',
        'SWEET_freq ~ MONITORING' = 'Sugary food intake by monitoring'
        )

modelsummary(
  c(sublist2$FV_freq,
    sublist2$SSB_freq,
    sublist2$JUNK_freq, 
    sublist2$SWEET_freq),
  fmt = 1,
  estimate  = "{estimate} [{conf.low}, {conf.high}],{stars}",
  statistic = NULL,
  )
```


# 12/7/23
Found an issue with the model. It doesn't seem possible that sex is a mediator given that food parenting practices doesn't cause the person's sex. So two things:
1. Make sex the IV and food parenting practices the DV
2. Make sex the moderator of food parenting practices

## Return to the basic models
### Is there a difference in food intake by parent sex?

```{r}
modelsT <- list(
  "Difference in parent sex: Fruits and Vegetables"     = t.test(FV_freq ~ Q6_11, data = scaled_data),
  "Difference in parent sex: SSB"     = t.test(SSB_freq ~ Q6_11, data = scaled_data),
  "Difference in parent sex: Junk Foods"     = t.test(JUNK_freq ~ Q6_11, data = scaled_data),
  "Difference in parent sex: Sugary foods"     = t.test(SWEET_freq ~ Q6_11, data = scaled_data)
)
```

```{r}
pFV <- ggplot(scaled_data, aes(factor(Q6_11), Fruits.vegetables)) + 
  geom_violin() + 
  stat_summary(fun = "mean",
               geom = "crossbar", 
               width = 0.5,
               colour = "red") + 
  scale_x_discrete(breaks=c("1", "2"),
                      labels=c("Male", "Female")) +
  labs(title="Fruit and vegetable intakeby parent sex",
        x ="Parent Sex", y = "Frequency of fruit and vegetable intake")

pSSB <- ggplot(scaled_data, aes(factor(Q6_11), SSB)) + 
  geom_violin() + 
  stat_summary(fun = "mean",
               geom = "crossbar", 
               width = 0.5,
               colour = "red") + 
  scale_x_discrete(breaks=c("1", "2"),
                      labels=c("Male", "Female")) +
  labs(title="SSB intakeby parent sex",
        x ="Parent Sex", y = "Frequency of SSB intake")

pIND <- ggplot(scaled_data, aes(factor(Q6_11), Indulgence)) + 
  geom_violin() + 
  stat_summary(fun = "mean",
               geom = "crossbar", 
               width = 0.5,
               colour = "red") + 
  scale_x_discrete(breaks=c("1", "2"),
                      labels=c("Male", "Female")) +
  labs(title="Indulgent parenting by parent sex",
        x ="Parent Sex", y = "Indulgent parenting")

pMON <- ggplot(scaled_data, aes(factor(Q6_11), Monitoring)) + 
  geom_violin() + 
  stat_summary(fun = "mean",
               geom = "crossbar", 
               width = 0.5,
               colour = "red") + 
  scale_x_discrete(breaks=c("1", "2"),
                      labels=c("Male", "Female")) +
  labs(title="Parental monitoring by parent sex",
        x ="Parent Sex", y = "Monitoring")

```
# Display
```{r}
modelsummary(
  modelsT,
  fmt = 1,
  estimate  = "{estimate} [{conf.low}, {conf.high}] {stars}",
  statistic = NULL,
  coef_omit = "Intercept",
  coef_rename = c("Q6_11" = "parent sex"))
grid.arrange(pFV, pSSB,pIND, pMON, nrow = 2)
```
## Summary
Parental sex is weakly related to SSB and FV consumption.

## Basic model
food security, parent education, child sex, race/ethnicity, independent eating occasions (from covar analysis)
```{r}
mFV <-'FV_freq ~ INDULGENCE + EXPECATION + AVAILABILE + MONITORING + AUTONOMY + MODELING + Q6_11  + Race + Sex + Education + Food.security + iEO + Marital.status'
mSSB <-'SSB_freq ~ INDULGENCE + EXPECATION + AVAILABILE + MONITORING + AUTONOMY + MODELING + Q6_11  + Race + Sex + Education + Food.security + iEO + Marital.status'
mJUNK <-'JUNK_freq ~ INDULGENCE + EXPECATION + AVAILABILE + MONITORING + AUTONOMY + MODELING + Q6_11  + Race + Sex + Education + Food.security + iEO + Marital.status'
mSWEET <-'SWEET_freq ~ INDULGENCE + EXPECATION + AVAILABILE + MONITORING + AUTONOMY + MODELING + Q6_11  + Race + Sex + Education + Food.security + iEO + Marital.status'
```

```{r}
models <- list(
  "Fruits and Vegetables"     = lm(mFV, data = scaled_data),
  "SSB"                       = lm(mSSB, data = scaled_data),
  "Junk Foods"                = lm(mJUNK, data = scaled_data),
  "Sugary foods"              = lm(mSWEET, data = scaled_data)
)

modelsummary(
  models,
  fmt = 1,
  estimate  = "{estimate} [{conf.low}, {conf.high}] {stars}",
  statistic = NULL,
  coef_omit = "Intercept",
  coef_rename = c("Q6_11" = "parent sex", "RaceHispanic" = "Hispanic", "RaceNon-Hispanic Black" = "Non-Hispanic Black","RaceNon-Hispanic White" = "Non-Hispanic White", "SexGirl" = "Child girl", "RaceAsian" = "Asian", "RaceOther races" = "Other races", "Food.securityFood secure" = "Food secure", "Marital.status" = "Marital status"))
```

## Monitoring and availability are related to food intake controlling for all other parental variables, sex, child sex,education, food secuirty, education

# Mediation
Does indulgence or monitoring mediate consumption of SSB or FV?
```{r}
parent <- "MONITORING"
food <- "SSB_freq"
```


```{r}
modelr <- function(parent,food){
  sprintf("
         # mediator, a path the effect of sex on food parenting
         %s ~ a*Q6_11

         # b path, the effect of parenting on food intake
         %s ~ b*%s+iEO

         # direct effect, the effect of sex on food intake
         Q6_11 ~ cp * %s+iEO

         # indirect 
         ab := a*b
         
         # Total effects
         total := cp + (a*b)
        ",parent, food, parent, food)
}
```

```{r}
checkMonSSB <-sem(modelr("MONITORING","SSB_freq"), data = scaled_data, estimator = "MLM")
checkIndSSB <-sem(modelr("INDULGENCE","SSB_freq"), data = scaled_data, estimator = "MLM")

checkMonFV <-sem(modelr("MONITORING","FV_freq"), data = scaled_data, estimator = "MLM")
checkIndFV <-sem(modelr("INDULGENCE","FV_freq"), data = scaled_data, estimator = "MLM")
```


```{r}
 fct <- function(fit) {
    lavaan::standardizedSolution(fit)[, "est.std"]
  }
```
## Bootstrap to get p values and confInt
```{r}
checkMonSSB_boot <- bootstrapLavaan(checkMonSSB, R = 4999, FUN = fct, iseed = 8970)
checkIndSSB_boot <- bootstrapLavaan(checkIndSSB, R = 5000, FUN = fct, iseed = 8970)
checkMonFV_boot <- bootstrapLavaan(checkMonFV, R = 5000, FUN = fct, iseed = 8970)
checkIndFV_boot <- bootstrapLavaan(checkIndFV, R = 5000, FUN = fct, iseed = 8970)
```

## The p values of the important parts
1, 2, 4, 10, 11
### Monitoring SSB
```{r}
# The mon SSB failed to converge once and now has an NA, need to remove
X<-checkMonSSB_boot[,1][!is.na(checkMonSSB_boot[,1])] 
X2<-checkMonSSB_boot[,2][!is.na(checkMonSSB_boot[,2])] 
X4<-checkMonSSB_boot[,4][!is.na(checkMonSSB_boot[,4])] 
X10<-checkMonSSB_boot[,10][!is.na(checkMonSSB_boot[,10])] 
X11<-checkMonSSB_boot[,11][!is.na(checkMonSSB_boot[,11])] 
X11
# Values of the model coefficients
Betas <- standardizedSolution(checkMonSSB)[,"est.std"]
Betas[11]
#Get the p-values for coefficient
P_val1 <-mean( abs(X - mean(X, na.rm = T) )> abs( Betas[1]))
P_val2 <-mean( abs(X2 - mean(X2, na.rm = T) )> abs( Betas[2]))
P_val4 <-mean( abs(X4 - mean(X4, na.rm = T) )> abs( Betas[4]))
P_val10 <-mean( abs(X10 - mean(X10, na.rm = T) )> abs( Betas[10]))
P_val11 <-mean( abs(X11 - mean(X11, na.rm = T) )> abs( Betas[11]))
SSBmonP<-c(P_val1, P_val2, P_val4, P_val10, P_val11)
SSBmonP
#and some parametric bootstrap confidence intervals (2.5%, 97.5%) 
ConfInt1 <- quantile(X, c(.025, 0.975), na.rm = TRUE)
ConfInt2 <- quantile(X2, c(.025, 0.975), na.rm = TRUE)
ConfInt4 <- quantile(X4, c(.025, 0.975), na.rm = TRUE)
ConfInt10 <- quantile(X10, c(.025, 0.975), na.rm = TRUE)
ConfInt11 <- quantile(X11, c(.025, 0.975), na.rm = TRUE)
SSBmonCI<-c(ConfInt1, ConfInt2, ConfInt4, ConfInt10, ConfInt11)
SSBmonCI
```

### Monitoring FV
```{r}
X<-checkMonFV_boot[,1][!is.na(checkMonFV_boot[,1])] 
X2<-checkMonFV_boot[,2][!is.na(checkMonFV_boot[,2])] 
X4<-checkMonFV_boot[,4][!is.na(checkMonFV_boot[,4])] 
X10<-checkMonFV_boot[,10][!is.na(checkMonFV_boot[,10])] 
X11<-checkMonFV_boot[,11][!is.na(checkMonFV_boot[,11])] 

# Values of the model coefficients
Betas <- standardizedSolution(checkMonFV)[,"est.std"]
Betas[11]
#Get the p-values for coefficient
P_val1 <-mean( abs(X - mean(X, na.rm = T) )> abs( Betas[1]))
P_val2 <-mean( abs(X2 - mean(X2, na.rm = T) )> abs( Betas[2]))
P_val4 <-mean( abs(X4 - mean(X4, na.rm = T) )> abs( Betas[4]))
P_val10 <-mean( abs(X10 - mean(X10, na.rm = T) )> abs( Betas[10]))
P_val11 <-mean( abs(X11 - mean(X11, na.rm = T) )> abs( Betas[11]))
FVmonP<-c(P_val1, P_val2, P_val4, P_val10, P_val11)

#and some parametric bootstrap confidence intervals (2.5%, 97.5%) 
ConfInt1 <- quantile(X, c(.025, 0.975), na.rm = TRUE)
ConfInt2 <- quantile(X2, c(.025, 0.975), na.rm = TRUE)
ConfInt4 <- quantile(X4, c(.025, 0.975), na.rm = TRUE)
ConfInt10 <- quantile(X10, c(.025, 0.975), na.rm = TRUE)
ConfInt11 <- quantile(X11, c(.025, 0.975), na.rm = TRUE)
FVmonCI<-c(ConfInt1, ConfInt2, ConfInt4, ConfInt10, ConfInt11)
```
### Indugence FV
```{r}
X<-checkIndFV_boot[,1][!is.na(checkIndFV_boot[,1])] 
X2<-checkIndFV_boot[,2][!is.na(checkIndFV_boot[,2])] 
X4<-checkIndFV_boot[,4][!is.na(checkIndFV_boot[,4])] 
X10<-checkIndFV_boot[,10][!is.na(checkIndFV_boot[,10])] 
X11<-checkIndFV_boot[,11][!is.na(checkIndFV_boot[,11])] 

# Values of the model coefficients
Betas <- standardizedSolution(checkIndFV)[,"est.std"]
Betas[11]
#Get the p-values for coefficient
P_val1 <-mean( abs(X - mean(X, na.rm = T) )> abs( Betas[1]))
P_val2 <-mean( abs(X2 - mean(X2, na.rm = T) )> abs( Betas[2]))
P_val4 <-mean( abs(X4 - mean(X4, na.rm = T) )> abs( Betas[4]))
P_val10 <-mean( abs(X10 - mean(X10, na.rm = T) )> abs( Betas[10]))
P_val11 <-mean( abs(X11 - mean(X11, na.rm = T) )> abs( Betas[11]))
FVIndP<-c(P_val1, P_val2, P_val4, P_val10, P_val11)
FVIndP
#and some parametric bootstrap confidence intervals (2.5%, 97.5%) 
ConfInt1 <- quantile(X, c(.025, 0.975), na.rm = TRUE)
ConfInt2 <- quantile(X2, c(.025, 0.975), na.rm = TRUE)
ConfInt4 <- quantile(X4, c(.025, 0.975), na.rm = TRUE)
ConfInt10 <- quantile(X10, c(.025, 0.975), na.rm = TRUE)
ConfInt11 <- quantile(X11, c(.025, 0.975), na.rm = TRUE)
FVIndCI<-c(ConfInt1, ConfInt2, ConfInt4, ConfInt10, ConfInt11)
FVIndCI
```
### Indugence SSB
```{r}
# The Ind SSB failed to converge once and now has an NA, need to remove
X<-checkIndSSB_boot[,1][!is.na(checkIndSSB_boot[,1])] 
X2<-checkIndSSB_boot[,2][!is.na(checkIndSSB_boot[,2])] 
X4<-checkIndSSB_boot[,4][!is.na(checkIndSSB_boot[,4])] 
X10<-checkIndSSB_boot[,10][!is.na(checkIndSSB_boot[,10])] 
X11<-checkIndSSB_boot[,11][!is.na(checkIndSSB_boot[,11])] 

# Values of the model coefficients
Betas <- standardizedSolution(checkIndSSB)[,"est.std"]

#Get the p-values for coefficient
P_val1 <-mean( abs(X - mean(X, na.rm = T) )> abs( Betas[1]))
P_val2 <-mean( abs(X2 - mean(X2, na.rm = T) )> abs( Betas[2]))
P_val4 <-mean( abs(X4 - mean(X4, na.rm = T) )> abs( Betas[4]))
P_val10 <-mean( abs(X10 - mean(X10, na.rm = T) )> abs( Betas[10]))
P_val11 <-mean( abs(X11 - mean(X11, na.rm = T) )> abs( Betas[11]))
SSBIndP<-c(P_val1, P_val2, P_val4, P_val10, P_val11)
SSBIndP
#and some parametric bootstrap confidence intervals (2.5%, 97.5%) 
ConfInt1 <- quantile(X, c(.025, 0.975), na.rm = TRUE)
ConfInt2 <- quantile(X2, c(.025, 0.975), na.rm = TRUE)
ConfInt4 <- quantile(X4, c(.025, 0.975), na.rm = TRUE)
ConfInt10 <- quantile(X10, c(.025, 0.975), na.rm = TRUE)
ConfInt11 <- quantile(X11, c(.025, 0.975), na.rm = TRUE)
SSBIndCI<-c(ConfInt1, ConfInt2, ConfInt4, ConfInt10, ConfInt11)
SSBIndCI
```
## Summary
Indulgent parenting mediates the relationship between parental sex and SSB intake
Indulgent parenting mediates the relationship between parental sex and FV intake
Monitoring parenting mediates the relationship between parental sex and SSB intake
Monitoring parenting mediates the relationship between parental sex and FV intake

# Moderation?
```{r}
mFVMON <-'FV_freq ~  MONITORING*as.factor(Q6_11)  + Race + Sex + Education + Food.security + iEO'
mSSBMON <-'SSB_freq ~ MONITORING*as.factor(Q6_11)  + Race + Sex + Education + Food.security + iEO'

mFVInd <-'FV_freq ~  INDULGENCE*as.factor(Q6_11)  + Race + Sex + Education + Food.security + iEO'
mSSBInd <-'SSB_freq ~ INDULGENCE*as.factor(Q6_11) + Race + Sex + Education + Food.security + iEO'

modelsLinear <- list(
  "Fruits and Vegetables monitoring"     = lm(mFVMON, data = scaled_data),
  "SSB monitoring"     = lm(mSSBMON, data = scaled_data),
  "Fruits and Vegetables indulgence"     = lm(mFVInd, data = scaled_data),
  "SSB indulgence"     = lm(mSSBInd, data = scaled_data)
)

modelsummary(
  modelsLinear,
  fmt = 1,
  estimate  = "{estimate} [{conf.low}, {conf.high}] {stars}",
  statistic = NULL,
  coef_omit = "Intercept",
  coef_rename = c("Q6_11" = "parent sex", "RaceHispanic" = "Hispanic", "RaceNon-Hispanic Black" = "Non-Hispanic Black","RaceNon-Hispanic White" = "Non-Hispanic White", "SexGirl" = "Child girl", "RaceAsian" = "Asian", "RaceOther races" = "Other races"))
```
# Summary of interactions
Monitoring interacts with parent gender for SSB
Availability interacts with gender for both FV and SSB

# Explore interactions
```{r}
SSBavail.lm <-lm(SSB_freq ~ AVAILABILE*as.factor(Q6_11) + Race + Sex + Education + Food.security + iEO, data = scaled_data)

FVavail.lm <-lm(FV_freq ~ AVAILABILE*as.factor(Q6_11) + Race + Sex + Education + Food.security + iEO, data = scaled_data)

SSBmon.lm <-lm(SSB ~ MONITORING*as.factor(Q6_11) + Race + Sex + Education + Food.security + iEO, data = scaled_data)
summary(SSBmon.lm)
emtrends(SSBmon.lm, pairwise ~ as.factor(Q6_11), var = "MONITORING")
emtrends(FVavail.lm, pairwise ~ as.factor(Q6_11), var = "AVAILABILE")
emtrends(SSBavail.lm, pairwise ~ as.factor(Q6_11), var = "AVAILABILE")

emmip(SSBmon.lm, as.factor(Q6_11) ~ MONITORING, cov.reduce = range)
emmip(SSBavail.lm, as.factor(Q6_11) ~ AVAILABILE, cov.reduce = range)
emmip(FVavail.lm, as.factor(Q6_11) ~ AVAILABILE, cov.reduce = range)
```
# Second check
```{r}
pkgs <- c("effectsize", "flextable", "interactions")
install_if_not_installed(pkgs)
```
SSB_freq ~ AVAILABILE*as.factor(Q6_11) + Race + Sex + Education + Food.security + iEO,
```{r}
moderations <- nice_mod(
  data = scaled_data,
  response = "SSB",
  predictor = "MONITORING",
  moderator = "Q6_11"
)
(my_table <- nice_table(moderations, highlight = TRUE))
```
# Post hoc analysis of food security
```{r}
test.lm <-lm(SSB_freq ~ Food.security*AVAILABILE*as.factor(Q6_11) + Race + Sex + Education +  iEO, data = scaled_data)
summary(test.lm)

test2.lm <-lm(FV_freq ~ Food.security*AVAILABILE*as.factor(Q6_11) + Race + Sex + Education +  iEO, data = scaled_data)
summary(test2.lm)
scaled_data$Education

summary(as.factor(scaled_data$Food.security))
as.numeric(as.character(scaled_data$Food.security))
as.numeric(levels(scaled_data$Food.security))[scaled_data$Food.security]
levels(scaled_data$Food.security)
scaled_data$Food.security<-as.factor(scaled_data$Food.security)

scaled_data$Food.security.int<-as.integer(scaled_data$Food.security)

nice_mod(
  data = scaled_data,
  response = "SSB_freq",
  predictor = "AVAILABILE",
  moderator = "Q6_11",
  moderator2 = "Food.security.int",
  covariates = c("Education", "iEO")
) |>
  nice_table(highlight = TRUE)

```

# Post hoc analysis marital status
## Monitoring
```{r}
ms.lm<-lm(MONITORING ~ as.factor(Q6_11)*as.factor(Marital.status), data = scaled_data)
summary(ms.lm)

t.test(MONITORING ~ Q6_11, data = scaled_data) # different between parent sex
t.test(MONITORING ~ Q6_11, data = subset(scaled_data, scaled_data$Marital.status == 1)) #not different between parent sex
t.test(MONITORING ~ Q6_11, data = subset(scaled_data, scaled_data$Marital.status == 2)) #different between parent sex

maritalModels <- list(
  "Differences in monitoring by parent sex overall"     = t.test(MONITORING ~ Q6_11, data = scaled_data),
  "Differences in monitoring by parent sex when the parent is married"     = t.test(MONITORING ~ Q6_11, data = subset(scaled_data, scaled_data$Marital.status == 1)),
  "Differences in monitoring by parent sex when the parent is NOT married"     = t.test(MONITORING ~ Q6_11, data = subset(scaled_data, scaled_data$Marital.status == 2))
)

modelsummary(
  maritalModels,
  fmt = 1,
  estimate  = "{estimate} [{conf.low}, {conf.high}] {stars}",
  statistic = NULL,
  coef_omit = "Intercept",
  coef_rename = c("Q6_11" = "parent sex", "RaceHispanic" = "Hispanic", "RaceNon-Hispanic Black" = "Non-Hispanic Black","RaceNon-Hispanic White" = "Non-Hispanic White", "SexGirl" = "Child girl", "RaceAsian" = "Asian", "RaceOther races" = "Other races"))
```

Monitoring is different between parental sex when the parent is married, with the male parenting showing higher level of monitoring
However, when parent is single there is no difference in monitoring.
## Availability
```{r}
ms.lm<-lm(AVAILABILE ~ as.factor(Q6_11)*as.factor(Marital.status), data = scaled_data)
summary(ms.lm)

t.test(AVAILABILE ~ Q6_11, data = scaled_data) # different between parent sex
t.test(AVAILABILE ~ Q6_11, data = subset(scaled_data, scaled_data$Marital.status == 1)) #not different between parent sex
t.test(AVAILABILE ~ Q6_11, data = subset(scaled_data, scaled_data$Marital.status == 2)) #different between parent sex

maritalModels2 <- list(
  "Differences in AVAILABILE by parent sex overall"     = t.test(AVAILABILE ~ Q6_11, data = scaled_data),
  "Differences in AVAILABILE by parent sex when the parent is married"     = t.test(AVAILABILE ~ Q6_11, data = subset(scaled_data, scaled_data$Marital.status == 1)),
  "Differences in AVAILABILE by parent sex when the parent is NOT married"     = t.test(AVAILABILE ~ Q6_11, data = subset(scaled_data, scaled_data$Marital.status == 2))
)

modelsummary(
  maritalModels2,
  fmt = 1,
  estimate  = "{estimate} [{conf.low}, {conf.high}] {stars}",
  statistic = NULL,
  coef_omit = "Intercept",
  coef_rename = c("Q6_11" = "parent sex", "RaceHispanic" = "Hispanic", "RaceNon-Hispanic Black" = "Non-Hispanic Black","RaceNon-Hispanic White" = "Non-Hispanic White", "SexGirl" = "Child girl", "RaceAsian" = "Asian", "RaceOther races" = "Other races"))
```
No differences in availability between parental sex and it does not interact with marital status

# Food security
## Availability
```{r}
ms.lm<-lm(AVAILABILE ~ as.factor(Q6_11)*as.factor(Food.security), data = scaled_data)
summary(ms.lm)

t.test(AVAILABILE ~ Q6_11, data = scaled_data) # different between parent sex
t.test(AVAILABILE ~ Q6_11, data = subset(scaled_data, scaled_data$Food.security == "Food insecure")) 
t.test(AVAILABILE ~ Q6_11, data = subset(scaled_data, scaled_data$Food.security == "Food secure")) 

securityModels2 <- list(
  "Differences in AVAILABILE by parent sex overall"     = t.test(AVAILABILE ~ Q6_11, data = scaled_data),
  "Differences in AVAILABILE by parent sex when the parent is food insecure"     = t.test(AVAILABILE ~ Q6_11, data = subset(scaled_data, scaled_data$Food.security == "Food insecure")),
  "Differences in AVAILABILE by parent sex when the parent is secure"     = t.test(AVAILABILE ~ Q6_11, data = subset(scaled_data, scaled_data$Food.security == "Food secure"))
)

modelsummary(
  securityModels2,
  fmt = 1,
  estimate  = "{estimate} [{conf.low}, {conf.high}] {stars}",
  statistic = NULL,
  coef_omit = "Intercept",
  coef_rename = c("Q6_11" = "parent sex", "RaceHispanic" = "Hispanic", "RaceNon-Hispanic Black" = "Non-Hispanic Black","RaceNon-Hispanic White" = "Non-Hispanic White", "SexGirl" = "Child girl", "RaceAsian" = "Asian", "RaceOther races" = "Other races"))
```
Food insecurity does not interact with parent sex to influence availability

```{r}
load(file = "/Users/gracer/Library/CloudStorage/OneDrive-UniversityofWyoming/0. Lab/M2AENAD Lab - Documents/RESEARCH/multi-state/gender_paper/gender_analysis.RData")
```


```{r}
#save.image(file = "/Users/gracer/Library/CloudStorage/OneDrive-UniversityofWyoming/0. Lab/M2AENAD Lab - Documents/RESEARCH/multi-state/gender_paper/gender_analysis.RData")
```

# this is a change

